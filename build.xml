<!-- ================================================== -->
<!--        Ant build file for webCGH                   -->
<!-- ================================================== -->

<project name="webCGH" default="help" basedir=".">

	<!-- Basic configuration -->
	<property file="build.properties"/>
	<property name="classes.dir" value="${build.dir}/classes"/>
	<property name="lib.dir" value="${build.dir}/lib"/>
	<property name="src.dir" value="src"/>
	<property name="temp.dir" value="${build.dir}/temp"/>
	<property name="web.dir" value="webapp"/>
	<property name="conf.dir" value="${src.dir}/conf"/>
	<property name="db.src.dir" value="initdb"/>
	<!--<property file="src/conf/webcgh.properties"/>-->
	
	<path id="class.path">
		<fileset dir="${web.dir}/WEB-INF/lib" includes="*.*"/>
		<pathelement location="web/svg"/>
		<pathelement location="etc"/>
	</path>
    
    <!-- Collate some environment information into a buildInformation.properties
         file which the Status Page can report on -->
    <target name="document-build-properties">
        <mkdir dir="${web.dir}"/>
        <mkdir dir="${web.dir}/WEB-INF"/>
        <mkdir dir="${web.dir}/WEB-INF/classes"/>
        <property environment="env"/>
        <!-- determine hostname -->
        <condition property="hostname" value="${env.HOSTNAME}">
          <os family="unix"/>
        </condition>
        <condition property="hostname" value="${env.COMPUTERNAME}">
          <os family="windows"/>
        </condition>
        <!-- generate build.properties file -->
        <echo>Did you update the release.tag property in the build.properties file???</echo>
        <propertyfile comment="Autogenerated Build Information - DO NOT EDIT"
            file="${web.dir}/WEB-INF/classes/buildInformation.properties">
            <entry
                key="release.tag"
                value="${release.tag}"/>
            <entry
                key="build.date"
                type="date"
                pattern="EEEE MMM dd, yyyy"
                value="now"/>
            <entry
                key="build.time"
                type="date"
                pattern="kk:mm:ss"
                value="now"/>
            <entry
                key="build.timestamp"
                type="date"
                pattern="yyyy-MM-dd' 'HH:mm:ss"
                value="now"/>
            <entry key="build.user.name" value="${user.name}"/>
            <entry key="build.host" value="${hostname}"/>
        </propertyfile>
    </target>
	
	<!-- Copy hibernate web dtd files -->
    <!-- Removed - no hibernate xmls in the array package for the moment:
	<target name="copyhttphibernatexmls">
		<echo>Copy hibernate xml that point to http hibernate.dtd</echo>		
		<copy todir="${src.dir}/org/rti/webcgh/array/persistent/impl">
			<fileset dir="${src.dir}/org/rti/webcgh/array/persistent/buildxml" includes="**/*.xml"/>
		</copy>
	</target>
    -->

    <!-- Copy hibernate web dtd files -->
	<target name="copy-config">		
		<echo>Copy configuration files</echo>		
		<copy todir="${web.dir}/WEB-INF/classes/conf" overwrite="true">
			<fileset dir="${src.dir}/conf" includes="**/*.*"/>
		</copy>		
	</target>

	

	

	  <target name="configure-props">
         <delete dir="output/webGenome/war" quiet="true">
             <fileset><include name="**/**"/> </fileset>
         </delete>
         <mkdir dir="output/webGenome/war"/>
         <unwar src="${dist.dir}/webGenome.war" dest="output/webGenome/war"/>
         <!-- This is missing, but left uncommented, at least to show the error. TODO: fix -->
         <replaceregexp
             file="output/webGenome/war/WEB-INF/classes/conf/jndi.properties"
             match="JNDI-URL" replace="${java.naming.provider.url}"/>
		<replaceregexp
             file="output/webGenome/war/WEB-INF/classes/conf/webcgh.properties"
             match="DB-HOME" replace="${db.home}"/>

        <mkdir dir="output/webGenome/war/images"/>

         <copy todir="output/webGenome/war/images" overwrite="true">
			<fileset dir="${web.dir}/images" includes="**/*.*"/>
		</copy>
		
         <delete dir="output/webGenome/modified/war"  quiet="true">
            <fileset><include name="**/**"/></fileset>
        </delete>
        <mkdir dir="output/webGenome/modified/war"/>

        <war destfile="output/webGenome/modified/war/webGenome.war" webxml="output/webGenome/war/WEB-INF/web.xml">
                <fileset dir="output/webGenome/war" includes="**/*.*">                                            				<include name="*.*"/>
				</fileset>
				<fileset dir="output/webGenome/war/images" includes="**/*.*"/>
                <webinf dir="output/webGenome/war/WEB-INF"/>
                <metainf dir="output/webGenome/war/META-INF"/>
       </war>
       <copy file="output/webGenome/modified/war/webGenome.war" tofile="${dist.dir}/webGenome.war"
                overwrite="true" />

     </target>

<!-- Help -->
	<target name="help" description="Print a usage statement">
		<echo level="info" message="Usage: ant TARGET"/>
		<echo level="info" message=""/>
		<echo level="info" message="TARGET:"/>
		<echo level="info" message="   help  - Print this help message"/>
		<echo level="info" message="   usage - Print this help message"/>
	</target>
	<target name="usage" depends="help"/>

</project>